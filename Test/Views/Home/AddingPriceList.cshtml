@using Test.Domain.Entites
@model PriceList

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <div class="div-box">
        <button id="create" class="createPriceList" type="submit" onclick="AddCollumn()">Сохранить</button>
        <h5>Название прайс-листа*</h5>
        <input class="form-control" type="text" value="Прайс-лист от" id="NamePriceList" />
        <table id="submissionTable" class="table">
            <tr id="tablerow">        
            </tr>
        </table>
        <button id="add" class="addButton" type="button">Добавить колонку</button>
    </div>


@section Scripts{
    <script>
        const today = new Date();
        const yyyy = today.getFullYear();
        let mm = today.getMonth() + 1; // Months start at 0!
        let dd = today.getDate();

        if (dd < 10) dd = '0' + dd;
        if (mm < 10) mm = '0' + mm;

        const formattedToday = dd + '.' + mm + '.' + yyyy;

        document.getElementById("NamePriceList").value = "Прайс-лист от " + formattedToday;
        var counter = 1;
        $(function () {
            $('#add').click(function () {
                $('<tr id="tablerow' + counter + '"><td>' +
                    '"Колонка' +counter +'"</td><td>'+
                    '<input type="text" class="text-box single-line" id="Name[' + counter + ']" value="" required="required" />' +
                    '</td>' +
                    '<td>' +
                    '<select class= "textbox" id="DataType[' + counter + ']"  value ="">' +
                            '<option>Число</option>'+
                            '<option>Текст</option>'+
                        '</select>' +
                    '</td>' +
                    '<td>' +
                    '<button type="button" class="DeleteColumn" onclick="removeTr(' + counter + ');">Удалить</button>' +
                    '</td>' +
                    '</tr>').appendTo('#submissionTable');
                counter++;
                return false;
            });
        });
        function removeTr(index) {
            if (counter > 1) {
                $('#tablerow' + index).remove();
                counter--;
            }
            return false;
        };
        function AddCollumn(){
                var namePriceList = document.getElementById("NamePriceList").value;
                var table = document.getElementById('submissionTable');
                var names = [];
                var dataTypes = [];
                var columns = [];

                for (var i = 1; i < table.rows.length; i++) {

                    names[i-1] = document.getElementById('Name[' + i + ']').value;
                    var select = document.getElementById('DataType[' + i + ']');
                    dataTypes[i - 1] = select.options[select.selectedIndex].text;


                }
                for (var i = 0; i < table.rows.length-1;i++)
                {
                    columns.push({
                        Name: names[i],
                        DataType: dataTypes[i]
                    });
                }
                var data = ({
                    Name: namePriceList,
                    Columns: columns
                });
                $.ajax({
                    type: "post",
                    url: "/Home/AddPriceList",
                    data: JSON.stringify(data),
                    contentType: "application/json;charset=utf-8",
                    success: function (result) {
                        console.log(result);
                    },
                    error: function (req, status, error) {
                        console.log(status)
                    }
                });
                // window.location.href = '/Home/Index'
                
                

        }

    </script>
}
